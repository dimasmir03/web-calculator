# Распределённый вычислитель арифметических выражений

Контрольная работа
макс. Максимум 100 балл.100 баллов
Дедлайн: 2 мар., 23:30

### Распределённый вычислитель арифметических выражений

Мы продолжаем работать над вашим калькулятором.
Пользователь хочет считать арифметические выражения. Он вводит строку 2 + 2 * 2 и хочет получить в ответ 6. Но наши операции сложения и умножения (также деление и вычитания) выполняются "очень-очень" долго. Поэтому вариант, при котором пользователь делает http-запрос и получает в качестве ответа результат, невозможна. Более того: вычисление каждой такой операции в нашей "альтернативной реальности" занимает "гигантские" вычислительные мощности. Соответственно каждое действие мы должны уметь выполнять отдельно и масштабировать эту систему можем добавлением вычислительных мощностей в нашу систему в виде новых "машин". Поэтому пользователь может с какой-то периодичностью уточнять у сервера "не посчиталось ли выражение"? Если выражение наконец будет вычислено - то он получит результат. Помните, что некоторые части арифметического выражения можно вычислять параллельно.

## Back-end часть

Состоит из 2 элементов:

* Сервер, который принимает арифметическое выражение, переводит его в набор последовательных задач и обеспечивает порядок их выполнения. Далее будем называть его оркестратором.
* Вычислитель, который может получить от оркестратора задачу, выполнить его и вернуть серверу результат. Далее будем называть его агентом.

## Оркестратор

Сервер, который имеет следующие endpoint-ы:

* Добавление вычисления арифметического выражения  

```bash
curl --location 'localhost/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
  "expression": <строка с выражение>
}'
```

Коды ответа: 201 - выражение принято для вычисления, 422 - невалидные данные, 500 - что-то пошло не так

Тело ответа

```json
{  
  "id": "уникальный идентификатор выражения"  
}
```

* Получение списка выражений  

```bash
curl --location 'localhost/api/v1/expressions'
```

Тело ответа

```json
{  
  "expressions": [
        {
            "id": "идентификатор выражения",
            "status": "статус вычисления выражения",
            "result": "результат выражения"
        },
        {
            "id": "идентификатор выражения",
            "status": "статус вычисления выражения",
            "result": "результат выражения"
        }
    ]
}
```

Коды ответа:

* 200 - успешно получен список выражений
* 500 - что-то пошло не так
</br></br>
* Получение выражения по его идентификатору

```bash
curl --location 'localhost/api/v1/expressions/:id'
```

Коды ответа:

* 200 - успешно получено выражение
* 404 - нет такого выражения
* 500 - что-то пошло не так

Тело ответа

```json
{
    "expression":
        {
            "id": "идентификатор выражения",
            "status": "статус вычисления выражения",
            "result": "результат выражения"
        }
}
```

* Получение задачи для выполнения

```bash
curl --location 'localhost/internal/task'
```

Коды ответа:

* 200 - успешно получена задача
* 404 - нет задачи
* 500 - что-то пошло не так

Тело ответа

```json
{
    "task":
        {
            "id": "идентификатор задачи",
            "arg1": "имя первого аргумента",
            "arg2": "имя второго аргумента",
            "operation": "операция",
            "operation_time": "время выполнения операции"
        }
}
```

* Прием результата обработки данных.

```bash
curl --location 'localhost/internal/task' \
--header 'Content-Type: application/json' \
--data '{
  "id": 1,
  "result": 2.5
}'
```

Коды ответа:

* 200 - успешно записан результат
* 404 - нет такой задачи
* 422 - невалидные данные
* 500 - что-то пошло не так

Время выполнения операций задается переменными среды в миллисекундах  
TIME_ADDITION_MS - время выполнения операции сложения в миллисекундах  
TIME_SUBTRACTION_MS - время выполнения операции вычитания в миллисекундах  
TIME_MULTIPLICATIONS_MS - время выполнения операции умножения в миллисекундах  
TIME_DIVISIONS_MS - время выполнения операции деления в миллисекундах

## Агент

Демон, который получает выражение для вычисления с сервера, вычисляет его и отправляет на сервер результат выражения.

При старте демон запускает несколько горутин, каждая из которых выступает в роли независимого вычислителя. Количество горутин регулируется переменной среды COMPUTING_POWER

### Агент обязательно общается с оркестратором по http

Агент все время приходит к оркестратору с запросом "дай задачку поработать" (в ручку GET internal/task для получения задач). Оркестратор отдаёт задачу.

Агент производит вычисление и в ручку оркестратора (POST internal/task для приема результатов обработки данных) отдаёт результат

## Front-end часть

Если есть энтузиазм - то предлагаем реализовать веб-интерфейс над написанным вами API на свой вкус

## Правила оформления

* Проект размещен на github
* Проект снабжен Readme фалом - где подробно описано, о чем проект и как им пользоваться
Проект снабжён примерами использования с помощью curl (который покрывает разные сценарии: всё хорошо, ошибки)

```bash
curl --location 'localhost/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
  "expression": "2+2*2"
}'
```

* Отдельным блоком в документации идёт инструкция по запуску проекта (желательно, чтобы можно было просто скопировать какую-то команду и запустить ей проект)

```bash
go run ./cmd/calc_service/...
```

* Проект покрыт тестами

## Критерии оценки

* Существует Readme документ, в котором описано, как запустить систему и как ей пользоваться.
  * это может быть docker-compose, makefile, подробная инструкция - на ваш вкус
  * в Readme описаны примеры запросов с помощью curl-a или любым другими понятными образом
  * примеры полны и понятно, как их запустить
  * у системы есть документация со схемами, которая наглядно отвечает на вопрос: "Как это всё работает"  
Этот пункт дает 20 баллов. Без наличия такого файла - решение не проверяется.

* Программа запускается, и все примеры с вычислением арифметических выражений корректно работают - 20 баллов
* Программа запускается, и выполняются произвольные примеры с вычислением арифметических выражений - 20 баллов
* Вам понятна кодовая база и структура проекта - 20 баллов (это субъективный критерий, но чем проще ваше решение - тем лучше). Проверяющий в этом пункте честно отвечает на вопрос: "Смогу я сделать пулл-реквест в проект без нервного срыва?"
* Наличие веб-интерфейса дает дополнительные 20 баллов

Не стремитесь получить 100 баллов, стремитесь сделать на все 100% ту часть, которую вы собираетесь делать. Как говорил В. И. Ленин: "Лучше меньше, да лучше"

ВАЖНО: Если проверяющему непонятно как запустить приложение (в документации ничего не написано) - сразу ставим 0 (уточнение у автора запрашивать не нужно)

### <u>Внимание</u>

Эта задача - задача с **взаимопроверкой.**  
Внимательно прочитайте следующие правила.

1. Сдать задачу необходимо **строго до дедлайна.** Как только дедлайн пройдёт, все ученики, решившие задачу и отправившие решение, получают работы других учеников на проверку в разделе "Кросс-проверки" в LMS.
2. Приложите **ссылку на ваш проект на github** в поле редактора кода в LMS и не забудьте проверить, что доступ к ссылке **публичный.**
3. Проверять работы необходимо **строго** по критериям проверки, с которыми можно будет ознакомиться во вкладке с проверкой, сделать это необходимо за следующую неделю после дедлайна на решение.
4. Если вы не проверили задачи, которые вам назначили на проверку, то вы получаете **штраф**, который будет учитываться в рейтинге.

Команда курса желает вам удачи!
